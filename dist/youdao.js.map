{"version":3,"file":"youdao.js","sources":["../src/youdao.js"],"sourcesContent":["// #!/usr/bin/env node\n// 命令行有道翻译\n// http请求\n// const packages = require('../package.json')\n// const { version: VERSION } = packages\nimport { version as VERSION } from '../package.json'\nimport Printer from '@darkobits/lolcatjs'\nimport chalk from 'chalk'\nimport Table from 'cli-table2/src/table'\nimport { program } from 'commander'\nimport Configstore from 'configstore'\nimport figlet from 'figlet'\nimport superagent from 'superagent'\n\nconst conf = new Configstore('youdaoTom')\n\nconst DEFAULT_API_KEYS = {\n    key: 868480929,\n    keyfrom: 'toaijf'\n}\n\nconst key = conf.get('key') || DEFAULT_API_KEYS.key\nconst keyfrom = conf.get('keyfrom') || DEFAULT_API_KEYS.keyfrom\n\nconst logo = figlet.textSync('Youdao')\nconst logoPrinter = Printer.fromString(\n    `\\n=========================================   \\n 汤姆的youdao翻译${VERSION}\\n\\n${logo}\\n=========================================`\n)\n\nconst validJSON = (json) => {\n    try {\n        JSON.parse(json)\n        return true\n    } catch (err) {\n        return false\n    }\n}\n\nprogram\n    .allowUnknownOption()\n    .version(logoPrinter, '-V, --version')\n    .usage('translator <cmd> [input]')\n\nconst url = `http://fanyi.youdao.com/openapi.do?keyfrom=${keyfrom}&key=${key}&type=data&doctype=json&version=1.1`\n\nprogram\n    .command('set')\n    .description('config key,keyfrom')\n    .requiredOption('-key,--key <string>', 'youdao api key')\n    .requiredOption('-keyfrom,--keyfrom <string>', 'youdao api keyfrom')\n    .action((options) => {\n        console.log('cmd', options, options.key)\n        conf.set('key', options.key)\n        conf.set('keyfrom', options.keyfrom)\n    })\n\nprogram\n    .command('query', { isDefault: true })\n    .description('translate query')\n    .action((cmd, obj) => {\n        const word = obj.args?.join(' ')\n        superagent\n            .get(url)\n            .query({\n                q: word\n            })\n            .end((err, res) => {\n                if (err) {\n                    console.log('excuse me, try again')\n                    return false\n                }\n\n                try {\n                    if (!validJSON(res.text)) {\n                        console.log(`\\n ${chalk.red('有道翻译API出错信息:')}`)\n                        console.log(\n                            `\\n${'💔'.repeat(\n                                3\n                            )}来自您key的翻译API请求异常频繁，为保护其他用户的正常访问，只能暂时禁止您目前key的访问\\n`\n                        )\n\n                        console.log(\n                            `\\n你可以使用 ${chalk.red(\n                                'youdaotom set -key xxx -keyfrom yyy'\n                            )} 命令来配置你自己在网易申请的key和keyfrom,或者几个小时后再尝试，随着本npm包下载的用户数越多，很容易超出网易的限制\\n`\n                        )\n                        return false\n                    }\n                    const data = JSON.parse(res.text)\n                    const result = {}\n                    // 返回的数据处理\n                    if (data.basic) {\n                        result[word] = data.basic.explains\n                    } else if (data.translation) {\n                        result[word] = data.translation\n                    } else {\n                        console.error('error')\n                    }\n                    console.log()\n                    // 输出表格\n                    const table = new Table()\n                    table.push(result)\n                    console.log(table.toString())\n                } catch (error) {\n                    console.log(error.toString())\n                }\n            })\n    })\nif (!process.argv[2]) {\n    console.log(logoPrinter)\n    program.help()\n}\nprogram.parse(process.argv)\n"],"names":["conf","Configstore","DEFAULT_API_KEYS","key","get","keyfrom","logo","figlet","textSync","logoPrinter","Printer","fromString","concat","program","allowUnknownOption","version","usage","url","command","description","requiredOption","action","options","console","log","set","isDefault","cmd","obj","_obj$args","word","args","join","superagent","query","q","end","err","res","json","JSON","parse","validJSON","text","chalk","red","repeat","data","result","basic","explains","translation","error","table","Table","push","toString","process","argv","help"],"mappings":"yTAcMA,EAAO,IAAIC,UAAY,aAEvBC,EACG,UADHA,EAEO,SAGPC,EAAMH,EAAKI,IAAI,QAAUF,EACzBG,EAAUL,EAAKI,IAAI,YAAcF,EAEjCI,EAAOC,EAAM,QAACC,SAAS,UACvBC,EAAcC,EAAO,QAACC,WAAUC,+DAAAA,uBACoCA,OAAON,kDAYjFO,EAAAA,QACKC,qBACAC,QAAQN,EAAa,iBACrBO,MAAM,4BAEX,IAAMC,gDAAGL,OAAiDP,EAAO,SAAAO,OAAQT,EAAwC,uCAEjHU,EAAAA,QACKK,QAAQ,OACRC,YAAY,sBACZC,eAAe,sBAAuB,kBACtCA,eAAe,8BAA+B,sBAC9CC,QAAQC,IACLC,QAAQC,IAAI,MAAOF,EAASA,EAAQnB,KACpCH,EAAKyB,IAAI,MAAOH,EAAQnB,KACxBH,EAAKyB,IAAI,UAAWH,EAAQjB,YAGpCQ,EAAAA,QACKK,QAAQ,QAAS,CAAEQ,WAAW,IAC9BP,YAAY,mBACZE,QAAO,CAACM,EAAKC,KAAQ,IAAAC,EACZC,EAAeD,QAAXA,EAAGD,EAAIG,gBAAIF,SAARA,EAAUG,KAAK,KAC5BC,EAAAA,QACK7B,IAAIa,GACJiB,MAAM,CACHC,EAAGL,IAENM,KAAI,CAACC,EAAKC,KACP,GAAID,EAEA,OADAd,QAAQC,IAAI,yBACL,EAGX,IACI,IA5CDe,CAAAA,IACf,IAEI,OADAC,KAAKC,MAAMF,IACJ,EACT,MAAOF,GACL,OAAO,IAuCUK,CAAUJ,EAAIK,MAaf,OAZApB,QAAQC,UAAGZ,OAAOgC,EAAK,QAACC,IAAI,kBAC5BtB,QAAQC,IAAGZ,KAAAA,OACF,KAAKkC,OACN,GACH,sDAGLvB,QAAQC,IAAGZ,WAAAA,OACIgC,EAAAA,QAAMC,IACb,uCACH,wEAEE,EAEX,IAAME,EAAOP,KAAKC,MAAMH,EAAIK,MACtBK,EAAS,GAEXD,EAAKE,MACLD,EAAOlB,GAAQiB,EAAKE,MAAMC,SACnBH,EAAKI,YACZH,EAAOlB,GAAQiB,EAAKI,YAEpB5B,QAAQ6B,MAAM,SAElB7B,QAAQC,MAER,IAAM6B,EAAQ,IAAIC,EAAAA,QAClBD,EAAME,KAAKP,GACXzB,QAAQC,IAAI6B,EAAMG,YACpB,MAAOJ,GACL7B,QAAQC,IAAI4B,EAAMI,mBAIjCC,QAAQC,KAAK,KACdnC,QAAQC,IAAIf,GACZI,EAAOA,QAAC8C,QAEZ9C,EAAAA,QAAQ4B,MAAMgB,QAAQC"}