{"version":3,"file":"youdao.js","sources":["../src/youdao.js"],"sourcesContent":["// #!/usr/bin/env node\n// å‘½ä»¤è¡Œæœ‰é“ç¿»è¯‘\n// httpè¯·æ±‚\n// const packages = require('../package.json')\n// const { version: VERSION } = packages\nimport { version as VERSION } from '../package.json'\nimport Printer from '@darkobits/lolcatjs'\nimport chalk from 'chalk'\nimport Table from 'cli-table2/src/table'\nimport { program } from 'commander'\nimport Configstore from 'configstore'\nimport figlet from 'figlet'\nimport superagent from 'superagent'\n\nconst conf = new Configstore('youdaoTom')\n\nconst DEFAULT_API_KEYS = {\n    key: 868480929,\n    keyfrom: 'toaijf'\n}\n\nconst key = conf.get('key') || DEFAULT_API_KEYS.key\nconst keyfrom = conf.get('keyfrom') || DEFAULT_API_KEYS.keyfrom\n\nconst logo = figlet.textSync('Youdao')\nconst logoPrinter = Printer.fromString(\n    `\\n=========================================   \\n æ±¤å§†çš„youdaoç¿»è¯‘${VERSION}\\n\\n${logo}\\n=========================================`\n)\n\nconst validJSON = (json) => {\n    try {\n        JSON.parse(json)\n        return true\n    } catch (err) {\n        return false\n    }\n}\n\nprogram\n    .allowUnknownOption()\n    .version(logoPrinter, '-V, --version')\n    .usage('translator <cmd> [input]')\n\nconst url = `http://fanyi.youdao.com/openapi.do?keyfrom=${keyfrom}&key=${key}&type=data&doctype=json&version=1.1`\n\nprogram\n    .command('set')\n    .description('config key,keyfrom')\n    .requiredOption('-key,--key <string>', 'youdao api key')\n    .requiredOption('-keyfrom,--keyfrom <string>', 'youdao api keyfrom')\n    .action((options) => {\n        console.log('cmd', options, options.key)\n        conf.set('key', options.key)\n        conf.set('keyfrom', options.keyfrom)\n    })\n\nprogram\n    .command('query', { isDefault: true })\n    .description('translate query')\n    .action((cmd, obj) => {\n        const word = obj.args?.join(' ')\n        superagent\n            .get(url)\n            .query({\n                q: word\n            })\n            .end((err, res) => {\n                if (err) {\n                    console.log('excuse me, try again')\n                    return false\n                }\n\n                try {\n                    if (!validJSON(res.text)) {\n                        console.log(`\\n ${chalk.red('æœ‰é“ç¿»è¯‘APIå‡ºé”™ä¿¡æ¯:')}`)\n                        console.log(\n                            `\\n${'ğŸ’”'.repeat(\n                                3\n                            )}æ¥è‡ªæ‚¨keyçš„ç¿»è¯‘APIè¯·æ±‚å¼‚å¸¸é¢‘ç¹ï¼Œä¸ºä¿æŠ¤å…¶ä»–ç”¨æˆ·çš„æ­£å¸¸è®¿é—®ï¼Œåªèƒ½æš‚æ—¶ç¦æ­¢æ‚¨ç›®å‰keyçš„è®¿é—®\\n`\n                        )\n\n                        console.log(\n                            `\\nä½ å¯ä»¥ä½¿ç”¨ ${chalk.red(\n                                'youdaotom set -key xxx -keyfrom yyy'\n                            )} å‘½ä»¤æ¥é…ç½®ä½ è‡ªå·±åœ¨ç½‘æ˜“ç”³è¯·çš„keyå’Œkeyfrom,æˆ–è€…å‡ ä¸ªå°æ—¶åå†å°è¯•ï¼Œéšç€æœ¬npmåŒ…ä¸‹è½½çš„ç”¨æˆ·æ•°è¶Šå¤šï¼Œå¾ˆå®¹æ˜“è¶…å‡ºç½‘æ˜“çš„é™åˆ¶\\n`\n                        )\n                        return false\n                    }\n                    const data = JSON.parse(res.text)\n                    const result = {}\n                    // è¿”å›çš„æ•°æ®å¤„ç†\n                    if (data.basic) {\n                        result[word] = data.basic.explains\n                    } else if (data.translation) {\n                        result[word] = data.translation\n                    } else {\n                        console.error('error')\n                    }\n                    console.log()\n                    // è¾“å‡ºè¡¨æ ¼\n                    const table = new Table()\n                    table.push(result)\n                    console.log(table.toString())\n                } catch (error) {\n                    console.log(error.toString())\n                }\n            })\n    })\nif (!process.argv[2]) {\n    console.log(logoPrinter)\n    program.help()\n}\nprogram.parse(process.argv)\n"],"names":["conf","Configstore","DEFAULT_API_KEYS","key","get","keyfrom","logo","figlet","textSync","logoPrinter","Printer","fromString","program","allowUnknownOption","version","usage","url","command","description","requiredOption","action","options","console","log","set","isDefault","cmd","obj","word","args","_obj$args","join","superagent","query","q","end","err","res","json","JSON","parse","validJSON","text","chalk","red","repeat","data","result","basic","explains","translation","error","table","Table","push","toString","process","argv","help"],"mappings":"yTAcMA,EAAO,IAAIC,UAAY,aAEvBC,EACG,UADHA,EAEO,SAGPC,EAAMH,EAAKI,IAAI,QAAUF,EACzBG,EAAUL,EAAKI,IAAI,YAAcF,EAEjCI,EAAOC,UAAOC,SAAS,UACvBC,EAAcC,UAAQC,wGACqDL,kDAYjFM,UACKC,qBACAC,QAAQL,EAAa,iBACrBM,MAAM,4BAEX,IAAMC,uDAAoDX,kBAAeF,yCAEzES,UACKK,QAAQ,OACRC,YAAY,sBACZC,eAAe,sBAAuB,kBACtCA,eAAe,8BAA+B,sBAC9CC,QAAQC,IACLC,QAAQC,IAAI,MAAOF,EAASA,EAAQlB,KACpCH,EAAKwB,IAAI,MAAOH,EAAQlB,KACxBH,EAAKwB,IAAI,UAAWH,EAAQhB,YAGpCO,UACKK,QAAQ,QAAS,CAAEQ,WAAW,IAC9BP,YAAY,mBACZE,QAAO,CAACM,EAAKC,WACJC,YAAOD,EAAIE,yBAAJC,EAAUC,KAAK,KAC5BC,UACK5B,IAAIY,GACJiB,MAAM,CACHC,EAAGN,IAENO,KAAI,CAACC,EAAKC,QACHD,SACAd,QAAQC,IAAI,yBACL,WAxCRe,eAEXC,KAAKC,MAAMF,IACJ,EACT,MAAOF,UACE,IAuCUK,CAAUJ,EAAIK,aACfpB,QAAQC,iBAAUoB,UAAMC,IAAI,kBAC5BtB,QAAQC,gBACC,KAAKsB,OACN,yDAIRvB,QAAQC,sBACOoB,UAAMC,IACb,+GAGD,MAELE,EAAOP,KAAKC,MAAMH,EAAIK,MACtBK,EAAS,GAEXD,EAAKE,MACLD,EAAOnB,GAAQkB,EAAKE,MAAMC,SACnBH,EAAKI,YACZH,EAAOnB,GAAQkB,EAAKI,YAEpB5B,QAAQ6B,MAAM,SAElB7B,QAAQC,UAEF6B,EAAQ,IAAIC,UAClBD,EAAME,KAAKP,GACXzB,QAAQC,IAAI6B,EAAMG,YACpB,MAAOJ,GACL7B,QAAQC,IAAI4B,EAAMI,mBAIjCC,QAAQC,KAAK,KACdnC,QAAQC,IAAId,GACZG,UAAQ8C,QAEZ9C,UAAQ4B,MAAMgB,QAAQC"}