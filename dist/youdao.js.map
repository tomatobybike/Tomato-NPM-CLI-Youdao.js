{"version":3,"file":"youdao.js","sources":["../src/youdao.js"],"sourcesContent":["// #!/usr/bin/env node\n// ÂëΩ‰ª§Ë°åÊúâÈÅìÁøªËØë\n// httpËØ∑Ê±Ç\nimport Printer from '@darkobits/lolcatjs'\nimport chalk from 'chalk'\nimport Table from 'cli-table2/src/table'\nimport { program } from 'commander'\nimport Configstore from 'configstore'\nimport figlet from 'figlet'\nimport superagent from 'superagent'\n\nconst conf = new Configstore('youdaoTom')\n\nconst DEFAULT_API_KEYS = {\n    key: 868480929,\n    keyfrom: 'toaijf'\n}\n\nconst key = conf.get('key') || DEFAULT_API_KEYS.key\nconst keyfrom = conf.get('keyfrom') || DEFAULT_API_KEYS.keyfrom\n\nconst packages = require('../package.json')\n\nconst { version: VERSION } = packages\nconst logo = figlet.textSync('Youdao')\nconst logoPrinter = Printer.fromString(\n    `\\n=========================================   \\n Ê±§ÂßÜÁöÑyoudaoÁøªËØë${VERSION}\\n\\n${logo}\\n=========================================`\n)\n\nconst validJSON = (json) => {\n    try {\n        JSON.parse(json)\n        return true\n    } catch (err) {\n        return false\n    }\n}\n\nprogram\n    .allowUnknownOption()\n    .version(logoPrinter, '-V, --version')\n    .usage('translator <cmd> [input]')\n\nconst url = `http://fanyi.youdao.com/openapi.do?keyfrom=${keyfrom}&key=${key}&type=data&doctype=json&version=1.1`\n\nprogram\n    .command('set')\n    .description('config key,keyfrom')\n    .requiredOption('-key,--key <string>', 'youdao api key')\n    .requiredOption('-keyfrom,--keyfrom <string>', 'youdao api keyfrom')\n    .action((options) => {\n        console.log('cmd', options, options.key)\n        conf.set('key', options.key)\n        conf.set('keyfrom', options.keyfrom)\n    })\n\nprogram\n    .command('query', { isDefault: true })\n    .description('translate query')\n    .action((cmd, obj) => {\n        const word = obj.args?.join(' ')\n        superagent\n            .get(url)\n            .query({\n                q: word\n            })\n            .end((err, res) => {\n                if (err) {\n                    console.log('excuse me, try again')\n                    return false\n                }\n\n                try {\n                    if (!validJSON(res.text)) {\n                        console.log(`\\n ${chalk.red('ÊúâÈÅìÁøªËØëAPIÂá∫Èîô‰ø°ÊÅØ:')}`)\n                        console.log(\n                            `\\n${'üíî'.repeat(\n                                3\n                            )}Êù•Ëá™ÊÇ®keyÁöÑÁøªËØëAPIËØ∑Ê±ÇÂºÇÂ∏∏È¢ëÁπÅÔºå‰∏∫‰øùÊä§ÂÖ∂‰ªñÁî®Êà∑ÁöÑÊ≠£Â∏∏ËÆøÈóÆÔºåÂè™ËÉΩÊöÇÊó∂Á¶ÅÊ≠¢ÊÇ®ÁõÆÂâçkeyÁöÑËÆøÈóÆ\\n`\n                        )\n\n                        console.log(\n                            `\\n‰Ω†ÂèØ‰ª•‰ΩøÁî® ${chalk.red(\n                                'youdaotom set -key xxx -keyfrom yyy'\n                            )} ÂëΩ‰ª§Êù•ÈÖçÁΩÆ‰Ω†Ëá™Â∑±Âú®ÁΩëÊòìÁî≥ËØ∑ÁöÑkeyÂíåkeyfrom,ÊàñËÄÖÂá†‰∏™Â∞èÊó∂ÂêéÂÜçÂ∞ùËØïÔºåÈöèÁùÄÊú¨npmÂåÖ‰∏ãËΩΩÁöÑÁî®Êà∑Êï∞Ë∂äÂ§öÔºåÂæàÂÆπÊòìË∂ÖÂá∫ÁΩëÊòìÁöÑÈôêÂà∂\\n`\n                        )\n                        return false\n                    }\n                    const data = JSON.parse(res.text)\n                    const result = {}\n                    // ËøîÂõûÁöÑÊï∞ÊçÆÂ§ÑÁêÜ\n                    if (data.basic) {\n                        result[word] = data.basic.explains\n                    } else if (data.translation) {\n                        result[word] = data.translation\n                    } else {\n                        console.error('error')\n                    }\n                    console.log()\n                    // ËæìÂá∫Ë°®Ê†º\n                    const table = new Table()\n                    table.push(result)\n                    console.log(table.toString())\n                } catch (error) {\n                    console.log(error.toString())\n                }\n            })\n    })\nif (!process.argv[2]) {\n    console.log(logoPrinter)\n    program.help()\n}\nprogram.parse(process.argv)\n"],"names":["conf","Configstore","DEFAULT_API_KEYS","key","keyfrom","get","packages","require","version","VERSION","logo","figlet","textSync","logoPrinter","Printer","fromString","validJSON","json","JSON","parse","err","program","allowUnknownOption","usage","url","command","description","requiredOption","action","options","console","log","set","isDefault","cmd","obj","word","args","join","superagent","query","q","end","res","text","chalk","red","repeat","data","result","basic","explains","translation","error","table","Table","push","toString","process","argv","help"],"mappings":"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"}